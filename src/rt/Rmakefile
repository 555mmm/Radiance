# SCCSid "$SunId$ LBL"

#
#  Compiles for ray tracing programs.
#

OPT = -O -pipe
MACH = -DSTRUCTASSIGN -DBSD -DIEEE -f68881 /usr/lib/f68881.il
CFLAGS = $(MACH) $(OPT)
CC = cc

#
# The following are user-definable:
#
DESTDIR = .
INSTDIR = /usr/local/ray
INSTALL = cp

#
# The following paths must exist and be relative to root:
#
DEVDIR = $(INSTDIR)/dev
LIBDIR = /usr/local/lib/ray

#
# Library routines:
#
LIBS = -lm
COMPAT = malloc.o

#
# Device drivers for rview (see also devtable.c):
#
DOBJS = devtable.o devcomm.o aed.o tty.o editline.o x10.o xtwind.o \
	colortab.o nwsdev.o
DLIBS = -lX -lcps
DRIVERS = $(DEVDIR)/sun $(DEVDIR)/sun.com $(DEVDIR)/x11

#
# Standard object files:
#

RTOBJS = rtmain.o rtrace.o $(ROBJS)

RPOBJS = rpmain.o rpict.o image.o $(ROBJS)

RVOBJS = rvmain.o rview.o rv2.o rv3.o image.o $(DOBJS) $(ROBJS)

ROBJS = $(OCTOBJS) $(RAYOBJS) $(SURFOBJS) $(MATOBJS) \
	$(MODOBJS) $(SUPPOBJS) $(MISCOBJS) $(COMPAT)

OCTOBJS = octree.o readobj.o readoct.o objset.o otypes.o

RAYOBJS = raytrace.o ambient.o

SURFOBJS = face.o sphere.o source.o o_face.o cone.o \
		o_cone.o o_instance.o instance.o

MATOBJS = normal.o dielectric.o m_clip.o glass.o m_brdf.o

MODOBJS = p_func.o t_func.o p_data.o t_data.o text.o mx_func.o mx_data.o

SUPPOBJS = zeroes.o calexpr.o caldefn.o calfunc.o func.o noise3.o data.o

MISCOBJS = misc.o header.o mat4.o xf.o fvect.o savestr.o fgetline.o ealloc.o \
		color.o resolu.o

#
# What this makefile produces:
#

PROGS = $(DESTDIR)/rtrace $(DESTDIR)/rpict $(DESTDIR)/rview $(DESTDIR)/lookamb

all:	$(PROGS) $(DRIVERS)

install:	all
	$(INSTALL) $(PROGS) $(INSTDIR)

clean:
	rm -f *.o core

#
# Links:
#

$(DESTDIR)/rtrace:	$(RTOBJS)
	$(CC) $(CFLAGS) -o $(DESTDIR)/rtrace $(RTOBJS) $(LIBS)

$(DESTDIR)/rpict:	$(RPOBJS)
	$(CC) $(CFLAGS) -o $(DESTDIR)/rpict $(RPOBJS) $(LIBS)

$(DESTDIR)/rview:	$(RVOBJS)
	$(CC) $(CFLAGS) -o $(DESTDIR)/rview $(RVOBJS) $(DLIBS) $(LIBS)

$(DESTDIR)/lookamb:	lookamb.o
	$(CC) $(CFLAGS) -o $(DESTDIR)/lookamb lookamb.o

$(DEVDIR)/sun:	sundev.o devmain.o colortab.o editline.o
	$(CC) $(CFLAGS) -s -o $(DEVDIR)/sun devmain.o sundev.o colortab.o \
editline.o -lsuntool -lsunwindow -lpixrect $(LIBS)

$(DEVDIR)/sun.com:	suncom.o editline.o
	$(CC) $(CFLAGS) -s -o $(DEVDIR)/sun.com suncom.o editline.o

$(DEVDIR)/x11:	x11.o x11twind.o colortab.o devmain.o editline.o
	$(CC) $(CFLAGS) -s -o $(DEVDIR)/x11 x11.o x11twind.o devmain.o \
colortab.o editline.o -lX11 $(LIBS)

#
# Special compiles:
#

rtmain.o:	rmain.c
	$(CC) $(CFLAGS) -DRTRACE -DNICE=4 -DDEFPATH=\":$(LIBDIR)\" -c rmain.c
	mv rmain.o rtmain.o

rpmain.o:	rmain.c
	$(CC) $(CFLAGS) -DRPICT -DNICE=6 -DDEFPATH=\":$(LIBDIR)\" -c rmain.c
	mv rmain.o rpmain.o

rvmain.o:	rmain.c
	$(CC) $(CFLAGS) -DRVIEW -DDEFPATH=\":$(LIBDIR)\" -c rmain.c
	mv rmain.o rvmain.o

#
# Uncomment the following and add spec_rgb.o to MISCOBJS to model dispersion:
#
#dielectric.o:	dielectric.c source.h
#	$(CC) $(CFLAGS) -DDISPERSE -c dielectric.c
#
# end of dispersion compiles.

devcomm.o:	devcomm.c
	$(CC) $(CFLAGS) -DDEVPATH=\"$(DEVDIR)\" -c devcomm.c

sundev.o:	sundev.c
	$(CC) $(CFLAGS) -DTTYPROG=\"$(DEVDIR)/sun.com\" -Dsun_init=dinit -c sundev.c

x11.o:	x11.c
	$(CC) $(CFLAGS) -Dx11_init=dinit -c x11.c

ambient.o:	ambient.c
	$(CC) $(CFLAGS) -DAMBFLUSH=16 -c ambient.c

calexpr.o:	calexpr.c calcomp.h
	$(CC) $(CFLAGS) -DVARIABLE -DFUNCTION -DINCHAN -DRCONST -c calexpr.c

caldefn.o:	caldefn.c calcomp.h
	$(CC) $(CFLAGS) -DFUNCTION -DREDEFW -c caldefn.c

calfunc.o:	calfunc.c calcomp.h
	$(CC) $(CFLAGS) -DVARIABLE -DBIGLIB -c calfunc.c

xf.o:	xf.c
	$(CC) $(CFLAGS) -DINVXF -c xf.c

nwsdev.o:	nwsdev.c nwsdev.h newsconstants.h
	$(CC) $(CFLAGS) -c nwsdev.c

nwsdev.h:	nwsdev.cps newsconstants.h
	cps nwsdev.cps

#
# Include dependencies:
#

caldefn.o calexpr.o calfunc.o:	calcomp.h

aed.o color.o colortab.o data.o devcomm.o spec_rgb.o \
devmain.o lookamb.o resolu.o rview.o sundev.o x10.o x11.o:	color.h

cone.o o_cone.o source.o:	cone.h

data.o mx_data.o p_data.o t_data.o:	data.h

aed.o devcomm.o devmain.o devtable.o \
editline.o nwsdev.o sundev.o tty.o x10.o x11.o:	driver.h

face.o o_face.o source.o:	face.h

fvect.o:	fvect.h

cone.o face.o objset.o otypes.o readobj.o readoct.o:	object.h

ambient.o objset.o octree.o raytrace.o readoct.o \
rpmain.o rtmain.o rtrace.o rvmain.o rv2.o rv3.o source.o:	octree.h

o_instance.o instance.o:	instance.h octree.h

ambient.o cone.o dielectric.o func.o normal.o o_cone.o objset.o \
otypes.o text.o raytrace.o readobj.o readoct.o rtrace.o \
rv2.o source.o sphere.o:	otypes.h

ambient.o rpict.o rv3.o source.o:	random.h

ambient.o dielectric.o func.o glass.o m_clip.o \
mx_data.o mx_func.o normal.o o_cone.o o_face.o o_instance.o \
p_data.o p_func.o text.o raytrace.o rpmain.o rtmain.o rvmain.o rpict.o \
rtrace.o rv2.o rv3.o source.o \
sphere.o t_data.o t_func.o:	ray.h standard.h fvect.h object.h color.h

rv2.o rv3.o rview.o:	rpaint.h driver.h view.h

source.o:	source.h

cone.o data.o devcomm.o face.o image.o misc.o objset.o octree.o otypes.o \
readobj.o readoct.o rview.o:	standard.h fvect.h

sundev.o:	suntools.icon

image.o rpmain.o rtmain.o rvmain.o rpict.o:	view.h

x10.o xtwind.o:	xtwind.h

x11.o x11twind.o: x11twind.h
